<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="memberTable">
    <resultMap id="selectMemberMap" type="memberDTO">
        <id column="idx" property="idx" />
        <result column="email" property="email" />
        <result column="password" property="password" />
        <result column="salt" property="salt" />
        <result column="refresh_token" property="refreshToken"/>
        <result column="grade" property="grade" />
        <result column="url" property="profileImageUrl" />
    </resultMap>
    <insert id="insertMemberByEmail" parameterType="memberDTO" useGeneratedKeys="true" keyProperty="idx" keyColumn="idx">
        INSERT INTO members_tb(email, password, salt, refresh_token)
        VALUES(#{email}, #{password}, #{salt}, #{refreshToken});
    </insert>
    <update id="updateRefreshToken" parameterType="memberDTO">
        UPDATE members_tb
        SET refresh_token = #{refreshToken}
        WHERE idx = #{idx};
    </update>
    <select id="searchMemberByEmail" resultMap="selectMemberMap">
        SELECT mtb.*, itb.url FROM members_tb mtb
        LEFT JOIN images_tb itb ON mtb.profile_image_idx = itb.idx
        WHERE mtb.email = #{email};
    </select>
    <select id="validMemberByEmail" parameterType="memberDTO" resultMap="selectMemberMap">
        SELECT * FROM members_tb
        WHERE email = #{email} AND password = #{password};
    </select>
</mapper>